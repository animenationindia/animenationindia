<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Browse All - Anime Nation India</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="style.css">
  <link rel="icon" type="image/png" href="ani-logo.png">
  <style>
    .view-all-container { padding-top: 6rem; min-height: 100vh; }
    .page-title-box { margin-bottom: 2rem; text-align: center; }
    .loader-box { display: flex; justify-content: center; padding: 3rem; font-size: 2rem; color: var(--primary); }
  </style>
</head>
<body>
  <header class="header">
    <nav class="nav-wrap">
      <a href="index.html" class="brand">
        <div class="brand-logo"><img src="ani-logo.png" style="width:100%;height:100%;object-fit:cover;border-radius:18px;"></div>
        <div class="brand-text"><span class="brand-title">Anime Nation India</span></div>
      </a>
      <div class="nav-right">
        <div class="social-row">
          <a class="social-btn" target="_blank" href="https://www.instagram.com/animenationindia?utm_source=ig_web_button_share_sheet&igsh=ZDNlZDc0MzIxNw=="><i class="fab fa-instagram"></i></a>
          <a class="social-btn" target="_blank" href="https://www.youtube.com/channel/UCnG6Pq8kh8BuueSF6Ni7-UQ"><i class="fab fa-youtube"></i></a>
        </div>
      </div>
    </nav>
  </header>

  <main class="page-wrap view-all-container">
    <div class="page-title-box">
      <h1 id="viewAllTitle" class="hero-title-highlight">Loading List...</h1>
      <p id="viewAllSub" class="section-sub">Fetching the latest data from MyAnimeList</p>
    </div>

    <div id="loader" class="loader-box"><i class="fas fa-spinner fa-spin"></i></div>
    <div class="grid-wrap" id="viewAllGrid"></div>

    <div class="ad-placeholder" style="margin-top: 3rem;">
      <script type="text/javascript">
        atOptions = { 'key' : 'cb071bb67e4808c6e6560437d566b4a9', 'format' : 'iframe', 'height' : 60, 'width' : 468, 'params' : {} };
      </script>
      <script src="https://www.highperformanceformat.com/cb071bb67e4808c6e6560437d566b4a9/invoke.js"></script>
    </div>
  </main>

  <footer class="footer">
    <p class="footer-copy">Â© 2026 Anime Nation India. Jikan API (V4).</p>
  </footer>

  <script>
    const JIKAN_API = "https://api.jikan.moe/v4";
    const urlParams = new URLSearchParams(window.location.search);
    const type = urlParams.get('type');
    const val = urlParams.get('val'); // For search
    const genreId = urlParams.get('id'); // For genre
    const genreName = urlParams.get('name');

    async function fetchViewAll() {
      let endpoint = "/top/anime";
      let title = "Popular Anime";

      if (type === 'trending') { endpoint = "/seasons/now"; title = "Trending Now"; }
      else if (type === 'upcoming') { endpoint = "/seasons/upcoming"; title = "Upcoming Next Season"; }
      else if (type === 'topManga') { endpoint = "/top/manga"; title = "Top Manga List"; }
      else if (type === 'search') { endpoint = `/anime?q=${val}`; title = `Search results for: ${val}`; }
      else if (type === 'genre_jikan') { endpoint = `/anime?genres=${genreId}`; title = `Genre: ${genreName}`; }

      document.getElementById('viewAllTitle').innerText = title;

      try {
        const res = await fetch(`${JIKAN_API}${endpoint}`);
        const json = await res.json();
        const data = json.data || [];
        
        document.getElementById('loader').style.display = 'none';
        const grid = document.getElementById('viewAllGrid');
        
        grid.innerHTML = data.map(item => {
          const isManga = type === 'topManga' || item.type === 'Manga';
          const itemType = isManga ? 'manga' : 'anime';
          const score = item.score ? item.score : 'N/A';
          const imgUrl = item.images?.webp?.large_image_url || item.images?.jpg?.large_image_url || '';
          
          return `
            <article class="anime-card" onclick="window.location.href='details.html?id=${item.mal_id}&type=${itemType}'">
              <img src="${imgUrl}" class="anime-card-img" loading="lazy">
              <div class="anime-card-body">
                <h3 class="anime-name">${item.title_english || item.title}</h3>
                <div class="anime-meta-row">
                  <span>${item.type}</span>
                  <span class="badge-status badge-ongoing">${score} <i class="fas fa-star" style="color:gold"></i></span>
                </div>
              </div>
            </article>
          `;
        }).join('');
      } catch (err) {
        console.error(err);
        document.getElementById('loader').innerHTML = "Failed to load data. Please refresh.";
      }
    }

    window.onload = fetchViewAll;
  </script>
</body>
</html>
