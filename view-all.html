<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Browse All - Anime Nation India</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="style.css">
  <link rel="icon" type="image/png" href="ani-logo.png">
  <style>
    .view-all-container { padding-top: 6rem; min-height: 100vh; }
    .page-title-box { margin-bottom: 2rem; text-align: center; }
    .loader-box { display: flex; justify-content: center; padding: 3rem; font-size: 2rem; color: var(--primary); }
  </style>
</head>
<body>
  <header class="header">
    <nav class="nav-wrap">
      <a href="index.html" class="brand">
        <div class="brand-logo"><img src="ani-logo.png" style="width:100%;height:100%;object-fit:cover;border-radius:18px;"></div>
        <div class="brand-text"><span class="brand-title">Anime Nation India</span></div>
      </a>
      <div class="nav-right">
        <div class="social-row">
          <a class="social-btn" target="_blank" href="https://www.instagram.com/animenationindia?utm_source=ig_web_button_share_sheet&igsh=ZDNlZDc0MzIxNw=="><i class="fab fa-instagram"></i></a>
          <a class="social-btn" target="_blank" href="https://www.youtube.com/channel/UCnG6Pq8kh8BuueSF6Ni7-UQ"><i class="fab fa-youtube"></i></a>
        </div>
      </div>
    </nav>
  </header>

  <main class="page-wrap view-all-container">
    <div class="page-title-box">
      <h1 id="viewAllTitle" class="hero-title-highlight">Loading List...</h1>
      <p id="viewAllSub" class="section-sub">Fetching the latest data...</p>
    </div>

    <div id="loader" class="loader-box"><i class="fas fa-spinner fa-spin"></i></div>
    <div class="grid-wrap" id="viewAllGrid"></div>

    <div class="ad-placeholder" style="margin-top: 3rem;">
      <script type="text/javascript">
        atOptions = { 'key' : 'cb071bb67e4808c6e6560437d566b4a9', 'format' : 'iframe', 'height' : 60, 'width' : 468, 'params' : {} };
      </script>
      <script src="https://www.highperformanceformat.com/cb071bb67e4808c6e6560437d566b4a9/invoke.js"></script>
    </div>
  </main>

  <footer class="footer">
    <p class="footer-copy">Â© 2026 Anime Nation India. Jikan & AniList API.</p>
  </footer>

  <script>
    const JIKAN_API = "https://api.jikan.moe/v4";
    const ANILIST_URL = "https://graphql.anilist.co";
    const urlParams = new URLSearchParams(window.location.search);
    const type = urlParams.get('type');
    const val = urlParams.get('val'); 
    const genreId = urlParams.get('id'); 
    const genreName = urlParams.get('name');

    async function fetchViewAll() {
      // ðŸ† Top 100 AniList Integration ðŸ†
      if (type === 'top100anilist') {
         document.getElementById('viewAllTitle').innerText = "ðŸ† Top 100 Anime";
         document.getElementById('viewAllSub').innerText = "Highest rated anime of all time (AniList).";
         const query = `query { Page(page: 1, perPage: 100) { media(type: ANIME, sort: SCORE_DESC, isAdult: false) { id title { english romaji } coverImage { large } averageScore format } } }`;
         try {
           const res = await fetch(ANILIST_URL, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ query }) });
           const json = await res.json();
           const data = json.data.Page.media || [];
           document.getElementById('loader').style.display = 'none';
           document.getElementById('viewAllGrid').innerHTML = data.map((item, index) => {
             const score = item.averageScore ? `${item.averageScore}%` : 'N/A';
             const format = item.format === 'TV' ? 'TV Show' : item.format || 'Anime';
             return `
               <article class="anime-card" onclick="window.location.href='details.html?anilist_id=${item.id}&type=anime'">
                 <img src="${item.coverImage.large}" class="anime-card-img" loading="lazy">
                 <div class="anime-card-body">
                   <h3 class="anime-name" style="color:var(--accent);">#${index + 1} ${item.title.english || item.title.romaji}</h3>
                   <div class="anime-meta-row"><span>${format}</span><span class="badge-status badge-ongoing">${score} <i class="fas fa-smile" style="color:#3edfa4"></i></span></div>
                 </div>
               </article>
             `;
           }).join('');
         } catch (err) { document.getElementById('loader').innerHTML = "Failed to load Top 100."; }
         return; 
      }

      // ðŸŽ¬ Latest Trailers Integration ðŸŽ¬
      else if (type === 'trailers') { 
         document.getElementById('viewAllTitle').innerText = "ðŸŽ¬ Latest Anime Trailers";
         document.getElementById('viewAllSub').innerText = "Catch the newest PVs and trailers.";
         try {
           const res = await fetch(`${JIKAN_API}/watch/promos/popular`);
           const json = await res.json();
           document.getElementById('loader').style.display = 'none';
           document.getElementById('viewAllGrid').innerHTML = json.data.map(item => {
             const imgUrl = item.trailer?.images?.maximum_image_url || item.entry?.images?.webp?.large_image_url;
             return `
               <article class="anime-card" onclick="window.location.href='details.html?id=${item.entry.mal_id}&type=anime'">
                 <div style="position:relative;">
                   <img src="${imgUrl}" class="anime-card-img" style="filter:brightness(0.7);" loading="lazy">
                   <i class="fas fa-play-circle" style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); font-size:4rem; color:#fff; text-shadow:0 4px 15px rgba(0,0,0,0.8);"></i>
                 </div>
                 <div class="anime-card-body">
                   <h3 class="anime-name">${item.entry.title}</h3>
                   <div class="anime-meta-row"><span>Trailer</span><span class="badge-status badge-ongoing">${item.title}</span></div>
                 </div>
               </article>
             `;
           }).join('');
         } catch(e) { document.getElementById('loader').innerHTML = "Failed to load trailers."; }
         return; 
      }

      // --- Jikan Logic (For other pages) ---
      let endpoint = "/top/anime";
      let title = "Popular Anime";

      if (type === 'trending') { endpoint = "/seasons/now"; title = "Trending Now"; }
      else if (type === 'upcoming') { endpoint = "/seasons/upcoming"; title = "Upcoming Next Season"; }
      else if (type === 'popularSeason') { endpoint = "/top/anime?filter=bypopularity"; title = "Popular Anime"; }
      else if (type === 'topManga') { endpoint = "/top/manga"; title = "Top Manga List"; }
      else if (type === 'search') { endpoint = `/anime?q=${val}`; title = `Search results for: ${val}`; }
      else if (type === 'genre_jikan') { endpoint = `/anime?genres=${genreId}`; title = `Genre: ${genreName}`; }

      document.getElementById('viewAllTitle').innerText = title;

      try {
        const res = await fetch(`${JIKAN_API}${endpoint}`);
        const json = await res.json();
        const data = json.data || [];
        document.getElementById('loader').style.display = 'none';
        document.getElementById('viewAllGrid').innerHTML = data.map(item => {
          const isManga = type === 'topManga' || item.type === 'Manga';
          const itemType = isManga ? 'manga' : 'anime';
          const score = item.score ? item.score : 'N/A';
          const imgUrl = item.images?.webp?.large_image_url || item.images?.jpg?.large_image_url || '';
          return `
            <article class="anime-card" onclick="window.location.href='details.html?id=${item.mal_id}&type=${itemType}'">
              <img src="${imgUrl}" class="anime-card-img" loading="lazy">
              <div class="anime-card-body">
                <h3 class="anime-name">${item.title_english || item.title}</h3>
                <div class="anime-meta-row"><span>${item.type || 'TV'}</span><span class="badge-status badge-ongoing">${score} <i class="fas fa-star" style="color:gold"></i></span></div>
              </div>
            </article>
          `;
        }).join('');
      } catch (err) { document.getElementById('loader').innerHTML = "Failed to load data. Please refresh."; }
    }

    window.onload = fetchViewAll;
  </script>
</body>
</html>
